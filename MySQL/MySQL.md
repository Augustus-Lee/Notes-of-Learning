#### 1.约束

##### 1.1主键约束

- **主键（primary key）**：一列(或一组列)，其值能够**唯一标识表中每一行**。通过给某个字段添加约束，就可以使得该字段不重复且不为空。

- ```sql
    --重复
    mysql> insert into user values('1','张三');
    ERROR 1062 (23000): Duplicate entry '1' for key 'user.PRIMARY'
    
    --不能为空
    mysql> insert into user values(NULL,'Lee');
    ERROR 1048 (23000): Column 'id' cannot be null
    ```

- 联合主键：多个字段都为主键；只要联合的主键值加起来不重复，但任意一个都不能为NULL

##### 1.2自增约束

- ```sql
    -- auto_increment 自增
    mysql> create table user3( id int primary key auto_increment, name varchar(20) );
    Query OK, 0 rows affected (0.03 sec)
    ```

##### 1.3唯一约束

- ```sql
    -- unique  使用alter添加
    mysql> alter table user4 add unique(name);
    Query OK, 0 rows affected (0.12 sec)
    Records: 0  Duplicates: 0  Warnings: 0
    
    --删除 unique
    mysql> alter table user4 drop index name;
    Query OK, 0 rows affected (0.03 sec)
    Records: 0  Duplicates: 0  Warnings: 0
    ```

##### 1.4非空约束

- 修饰的字段不能为空NULL
- not null

##### 1.5默认约束

- 插入字段值的时候没有传值，就会使用默认值;传了值就会使用默认值
- age int default 10 

##### 1.6外键约束

- 涉及到两个表：主表，附表

- **主表中的记录被副表使用，不可以被删除**

- **主表中的没有的数据值，副表中不可以使用**

- ```sql
    mysql> create table classes(
        -> id int primary key,
        -> name varchar(20));
    
    mysql> create table stu(
        -> num int primary key auto_increment,
        -> name varchar(20),
        -> classId int,
        -> foreign key(classId) references classes(id)  --外键
        -> );
    ```



#### 2.B树(Balance Tree)和B+树(B+Tree)

1. **B树(平衡多路查找树)** -- m阶：
    - 根结点至少有两个子节点，每个节点最多有m个子节点
    - 所有节点关键字是按递增次序排列，遵从左小右大规则。
    - **非叶子节点的关键字数量大于等于ceil(m/2)-1个且小于等于M-1个（ceil(1.1) = 2）**
    - 所有叶子节点均在同一层、叶子节点除了包含了关键字和关键字记录的指针外也有指向其子节点的指针只不过其指针地址都为null
2. **B+Tree：B树基础上的优化**
    1. **非叶子节点只保存键值信息，故非叶子节点保存的关键字大大增加。**B树节点既保存key也保存data
    2. **数据记录都存放在叶子节点**
    3. **各叶节点指针进行连接，构成一个有序链表**
    4. 优点：
        - **B+树的层级更少**：相较于B树B+每个**非叶子**节点存储的关键字数更多，树的层级更少所以查询数据更快；
        - **B+树查询速度更稳定**：B+所有关键字数据地址都存在**叶子**节点上，所以每次查找的次数都相同所以查询速度要比B树更稳定;
        - **B+树全节点遍历更快：**B+树遍历整棵树只需要遍历所有的**叶子**节点即可，，而不需要像B树一样需要对每一层进行遍历，这有利于数据库做全表扫描。
3. **B树**相对于**B+树**的优点：如果经常访问的**数据离根节点很近**，而**B树**的**非叶子**节点本身存有关键字其数据的地址，所以这种数据检索的时候会要比**B+树**快。

#### 3.数据库索引

- 索引是关系数据库中对某一列或多个列的值进行预排序的数据结构。
- 通过对数据库表创建索引，可以提高查询速度。
- 索引是一种**数据结构**。**MySQL常用是B+Tree**
- **缺点**：
    1. 索引会占用空间，表越大，索引占用的空间越大
    2. 性能损失，当进行删除、更新等操作时，索引也会进行相应操作。

#### 3.数据库事务

- 事务是数据库运行中的逻辑工作单位，由DBMS中的事务管理子系统负责事务的处理。

- 事务：**具有原子性的一组SQL操作语句，或者说是一个独立的工作单元**

- 一个逻辑工作单元要成为事务，必须满足所谓的**ACID（原子性、一致性、隔离性和持久性）属性**：

    - 原子性：一个事务必须被视为不可分割的最小工作单元，**整个事务的所有操作要么全部提交成功，要么全部失败回滚**，对于一个事务而言，不可以只执行一部分操作；
    - 一致性：**指事务使数据库从一个一致性状态变换到另一个一致性状态，也就是说一个事务执行之前和执行之后都必须处于一致性状态。**
    - 隔离性：事务隔离性是指多个事务并发执行时，相互之间无影响；**通常来说，一个事务在完全提交成功之前，对其他事物是不可见的**；
    - 持久性：**一旦事务提交，所做的修改就会永久保存到数据库中**。

- **数据库事务隔离：**

    1. 四种隔离级别：

        - **未提交读**：事务中的修改，即使没有提交，其他事务也是可见的。**事务可以读取未提交的数据，也称之为脏读。**实际应用中很少使用。
        - **提交读**：大多数数据库的默认隔离级别为**提交读**（MySQL不是）。**一个事务从开始到提交之前，所作的任何修改对其他事务是不可见的**，有时也称之为不可重复读，因为可能两次相同的查询会得到不同的结果。
            - 区别：不可重复读和脏读的区别是，**脏读是某一事务读取了另一个事务未提交的脏数据，而不可重复读则是读取了前一事务提交的数据。**
        - **可重复读（MySQL默认隔离级别）**：解决了脏读的问题；该级别保证了在同一事务中多次读取同样记录的结果是一致的；但无法解决**幻读**。
            - 幻读：某次事务在读取**某个范围**的记录时，另一个事务又在此范围内插入了新的记录，当之前的事务再次读取该范围的记录时，会产生**幻行**。
        - **可串行化：最高的隔离级别**。它通过强制事务串行执行，则可避免幻读的情况。简单来说，可串行化会在读每一行数据的时候都加锁，所以可能导致大量的超时和锁争用问题。

        ![SQL隔离级别](/Users/swqt/Desktop/Gus/Programming/img/SQL隔离级别.png)

